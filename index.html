<div id="markdown-container"></div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  const container = document.getElementById('markdown-container');
  let markdownFiles = [];  // 从 JSON 里加载的文件列表
  let loadedCount = 0;

  // 加载单个 md 文件内容并渲染
  async function loadMarkdown(url) {
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('加载失败：' + url);
      const text = await res.text();

      const block = document.createElement('div');
      block.className = 'markdown-block';
      block.innerHTML = marked.parse(text);
      container.appendChild(block);
    } catch (err) {
      console.error(err);
    }
  }

  // 初始化加载
  async function init() {
    try {
      const res = await fetch('data/files.json');
      if (!res.ok) throw new Error('加载 files.json 失败');
      markdownFiles = await res.json();

      // 加载前三个
      const initialLoadCount = Math.min(3, markdownFiles.length);
      for (let i = 0; i < initialLoadCount; i++) {
        await loadMarkdown(markdownFiles[i]);
        loadedCount++;
      }

      // 监听滚动实现懒加载
      window.addEventListener('scroll', handleScroll);
    } catch (err) {
      console.error(err);
      container.innerText = '无法加载文件列表';
    }
  }

  // 滚动处理函数
  function handleScroll() {
    if (loadedCount >= markdownFiles.length) {
      window.removeEventListener('scroll', handleScroll);
      return;
    }

    const scrollPosition = window.innerHeight + window.scrollY;
    const threshold = document.body.offsetHeight - 100;

    if (scrollPosition >= threshold) {
      loadMarkdown(markdownFiles[loadedCount]);
      loadedCount++;
    }
  }

  init();
</script>
<style>
  .markdown-block {
    background: #fff;
    margin: 1em 0;
    padding: 1em;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
</style>
